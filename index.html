<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø³Ø§Ø¨Ù‚Ø© Ø§Ù„Ø¯Ø§Ø¹ÙŠ Ø§Ù„ÙƒØ¨Ø±Ù‰</title>
    <style>
        /* --- Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ø¹Ø§Ù… (Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ) --- */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #000000; /* Ø®Ù„ÙÙŠØ© Ø³ÙˆØ¯Ø§Ø¡ */
            color: #ffffff;
            text-align: center;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        header {
            background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
            width: 100%;
            padding: 15px 0;
            border-bottom: 2px solid #444;
            z-index: 100;
        }
        h1 { margin: 0; font-size: 1.4rem; color: #f1c40f; }
        
        #game-container {
            width: 100%;
            max-width: 600px;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* --- Ø­Ø§ÙˆÙŠØ© Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ÙˆØªØ£Ø«ÙŠØ± Ø§Ù„Ø¸Ù„Ø§Ù… --- */
        .camera-wrapper {
            position: relative;
            width: 100%;
            height: 350px; /* Ø§Ø±ØªÙØ§Ø¹ Ø«Ø§Ø¨Øª Ù„Ù„ÙƒØ§Ù…ÙŠØ±Ø§ */
            overflow: hidden;
            background: #000;
        }
        
        video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transform: scaleX(-1); /* Ù…Ø±Ø¢Ø© */
            opacity: 0.8; /* Ø¬Ø¹Ù„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø®Ø§ÙØªØ§Ù‹ Ù‚Ù„ÙŠÙ„Ø§Ù‹ Ø¨Ø´ÙƒÙ„ Ø¹Ø§Ù… */
        }

        /* Ø§Ù„Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø³Ø­Ø±ÙŠ (Ø§Ù„ØªØ±ÙƒÙŠØ²) */
        .scanner-box {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80px;  /* Ù…Ø±Ø¨Ø¹ ØµØºÙŠØ± ÙƒÙ…Ø§ Ø·Ù„Ø¨Øª */
            height: 80px;
            border: 2px solid #fff;
            border-radius: 12px;
            z-index: 10;
            
            /* Ù‡Ø°Ø§ Ø§Ù„Ø¸Ù„ Ø§Ù„Ø¶Ø®Ù… Ù‡Ùˆ Ù…Ø§ ÙŠØ¬Ø¹Ù„ Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø´Ø§Ø´Ø© Ù…Ø¸Ù„Ù…Ø§Ù‹ */
            box-shadow: 0 0 0 100vh rgba(0, 0, 0, 0.7); 
        }

        /* Ù†Ù‚Ø·Ø© Ø­Ù…Ø±Ø§Ø¡ ØµØºÙŠØ±Ø© ØªØ¯Ù„ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø±ÙƒØ² */
        .scanner-box::after {
            content: '+';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: rgba(255,255,255,0.5);
            font-size: 20px;
        }

        /* --- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø© --- */
        #question-area {
            width: 90%;
            margin-top: -30px; /* Ù„Ø±ÙØ¹ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ù‚Ù„ÙŠÙ„Ø§Ù‹ ÙÙˆÙ‚ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ */
            z-index: 20;
            background: #1a1a1a;
            border-radius: 20px;
            padding: 20px;
            border: 1px solid #333;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.5);
        }

        .question-text {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 20px;
            color: #fff;
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .option {
            background: #333;
            padding: 15px;
            border-radius: 10px;
            position: relative;
            transition: all 0.3s;
            border-right: 5px solid transparent;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* Ø£Ù„ÙˆØ§Ù† Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª */
        .opt-green { border-right-color: #2ecc71; }
        .opt-yellow { border-right-color: #f1c40f; }
        .opt-red { border-right-color: #e74c3c; }

        /* ØªØ£Ø«ÙŠØ± Ø¹Ù†Ø¯ Ø§Ø®ØªÙŠØ§Ø± Ø¥Ø¬Ø§Ø¨Ø© */
        .option.selected {
            background: #444;
            transform: scale(1.02);
            box-shadow: 0 0 10px rgba(255,255,255,0.1);
        }

        /* Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø¯Ø§Ø®Ù„ Ø§Ù„Ø²Ø± */
        .result-badge {
            font-weight: bold;
            font-size: 1.2rem;
            display: none; /* Ù…Ø®ÙÙŠ Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹ */
        }

        /* Ø²Ø± Ø§Ù„Ø¨Ø¯Ø¡ */
        #start-screen {
            margin-top: 50px;
            padding: 20px;
        }
        #start-btn {
            background: #f1c40f;
            color: #000;
            border: none;
            padding: 15px 40px;
            font-size: 1.2rem;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
            margin-top: 20px;
        }

        canvas { display: none; }
    </style>
</head>
<body>

    <header>
        <h1>Ù…Ø³Ø§Ø¨Ù‚Ø© Ø§Ù„Ø¯Ø§Ø¹ÙŠ Ø§Ù„ÙƒØ¨Ø±Ù‰ ğŸ•Œ</h1>
    </header>

    <div id="start-screen">
        <p>ÙˆØ¬Ù‘Ù‡ Ø§Ù„Ù„ÙˆÙ† Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø±Ø¨Ø¹ Ø§Ù„ØµØºÙŠØ± Ù„Ù„Ø¥Ø¬Ø§Ø¨Ø©.</p>
        <button id="start-btn" onclick="startCamera()">Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ­Ø¯ÙŠ</button>
    </div>

    <div id="game-container" style="display: none;">
        <div class="camera-wrapper">
            <video id="video" autoplay playsinline></video>
            <div class="scanner-box"></div>
        </div>

        <div id="question-area">
            <div class="question-text" id="q-text">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
            
            <div class="options">
                <div class="option opt-green" id="card-green">
                    <span id="text-green">Ø®ÙŠØ§Ø± 1</span>
                    <span class="result-badge" id="res-green"></span>
                </div>

                <div class="option opt-yellow" id="card-yellow">
                    <span id="text-yellow">Ø®ÙŠØ§Ø± 2</span>
                    <span class="result-badge" id="res-yellow"></span>
                </div>

                <div class="option opt-red" id="card-red">
                    <span id="text-red">Ø®ÙŠØ§Ø± 3</span>
                    <span class="result-badge" id="res-red"></span>
                </div>
            </div>
            
            <p style="font-size: 0.8rem; color: #777; margin-top: 15px;">
                Ø§Ù„Ù†ØªÙŠØ¬Ø©: <span id="score">0</span>
            </p>
        </div>
    </div>

    <canvas id="canvas"></canvas>

    <script>
        // --- Ø¨Ù†Ùƒ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ---
        const questions = [
            { q: "Ù…Ø§ Ù‡ÙŠ Ø§Ù„Ø³ÙˆØ±Ø© Ø§Ù„ØªÙŠ Ù„Ø§ ØªØ¨Ø¯Ø£ Ø¨Ø§Ù„Ø¨Ø³Ù…Ù„Ø©ØŸ", green: "ÙŠÙˆÙ†Ø³", yellow: "Ø§Ù„ØªÙˆØ¨Ø©", red: "Ø§Ù„Ù†Ù…Ù„", correct: "yellow" },
            { q: "ÙƒÙ… Ø³Ù†Ø© Ø§Ø³ØªÙ…Ø±Øª Ø¯Ø¹ÙˆØ© Ø§Ù„Ù†Ø¨ÙŠ Ø³Ø±Ø§Ù‹ØŸ", green: "3 Ø³Ù†ÙˆØ§Øª", yellow: "5 Ø³Ù†ÙˆØ§Øª", red: "10 Ø³Ù†ÙˆØ§Øª", correct: "green" },
            { q: "Ù…Ù† Ù‡Ùˆ Ø³ÙŠÙ Ø§Ù„Ù„Ù‡ Ø§Ù„Ù…Ø³Ù„ÙˆÙ„ØŸ", green: "Ø¹Ù„ÙŠ Ø¨Ù† Ø£Ø¨ÙŠ Ø·Ø§Ù„Ø¨", yellow: "Ø­Ù…Ø²Ø© Ø¨Ù† Ø¹Ø¨Ø¯Ø§Ù„Ù…Ø·Ù„Ø¨", red: "Ø®Ø§Ù„Ø¯ Ø¨Ù† Ø§Ù„ÙˆÙ„ÙŠØ¯", correct: "red" },
            { q: "Ù…Ø§ Ù‡ÙŠ Ø£Ù‚ØµØ± Ø³ÙˆØ±Ø© ÙÙŠ Ø§Ù„Ù‚Ø±Ø¢Ù†ØŸ", green: "Ø§Ù„ÙƒÙˆØ«Ø±", yellow: "Ø§Ù„Ø¹ØµØ±", red: "Ø§Ù„Ù†ØµØ±", correct: "green" },
            { q: "ÙÙŠ Ø£ÙŠ ØºØ²ÙˆØ© Ø§Ø³ØªØ´Ù‡Ø¯ Ø¹Ù… Ø§Ù„Ù†Ø¨ÙŠ Ø­Ù…Ø²Ø©ØŸ", green: "Ø¨Ø¯Ø±", yellow: "Ø§Ù„Ø®Ù†Ø¯Ù‚", red: "Ø£Ø­Ø¯", correct: "red" }
        ];

        let currentQIndex = 0;
        let score = 0;
        let isScanning = false;
        let holdTimer = 0;
        let lastDetected = null;

        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        async function startCamera() {
            document.getElementById('start-screen').style.display = 'none';
            document.getElementById('game-container').style.display = 'flex';

            try {
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { facingMode: "environment" } 
                });
                video.srcObject = stream;
                loadQuestion();
                requestAnimationFrame(scanColors);
            } catch (err) {
                alert("ÙŠØ¬Ø¨ Ø§Ù„Ø³Ù…Ø§Ø­ Ù„Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ù„Ù„Ø¹Ù…Ù„");
            }
        }

        function loadQuestion() {
            if (currentQIndex >= questions.length) {
                document.getElementById('question-area').innerHTML = `<h2>Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©!<br>Ù†ØªÙŠØ¬ØªÙƒ: ${score}</h2>`;
                return;
            }

            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø£Ù„ÙˆØ§Ù† ÙˆØ§Ù„ÙˆØ§Ø¬Ù‡Ø©
            resetCards();
            
            const q = questions[currentQIndex];
            document.getElementById('q-text').innerText = q.q;
            document.getElementById('text-green').innerText = q.green;
            document.getElementById('text-yellow').innerText = q.yellow;
            document.getElementById('text-red').innerText = q.red;
            
            isScanning = true;
        }

        function scanColors() {
            if (!isScanning) {
                requestAnimationFrame(scanColors);
                return;
            }

            if (video.readyState === video.HAVE_ENOUGH_DATA) {
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;
                ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

                // ÙØ­Øµ Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ÙˆØ³Ø· (Ø§Ù„Ù…Ø±Ø¨Ø¹ Ø§Ù„ØµØºÙŠØ±)
                const frameData = ctx.getImageData(canvas.width/2 - 20, canvas.height/2 - 20, 40, 40);
                const color = detectColor(frameData.data);

                if (color) {
                    processSelection(color);
                } else {
                    holdTimer = 0;
                    lastDetected = null;
                    clearHighlights();
                }
            }
            requestAnimationFrame(scanColors);
        }

        function detectColor(data) {
            let r=0, g=0, b=0, count=0;
            for(let i=0; i<data.length; i+=4) {
                r+=data[i]; g+=data[i+1]; b+=data[i+2]; count++;
            }
            r/=count; g/=count; b/=count;

            // ØªØ­ÙˆÙŠÙ„ Ø¨Ø³ÙŠØ· Ù„Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù„ÙˆØ§Ù†
            // Ø§Ù„Ø£Ø­Ù…Ø±: R Ø¹Ø§Ù„ÙŠØŒ G Ùˆ B Ù…Ù†Ø®ÙØ¶
            // Ø§Ù„Ø£Ø®Ø¶Ø±: G Ø¹Ø§Ù„ÙŠ
            // Ø§Ù„Ø£ØµÙØ±: R Ùˆ G Ø¹Ø§Ù„ÙŠØ§Ù†
            
            if (r > 130 && g < 100 && b < 100) return "red";
            if (g > 110 && r < 100 && b < 100) return "green";
            if (r > 130 && g > 130 && b < 100) return "yellow";
            
            return null;
        }

        function processSelection(color) {
            if (color === lastDetected) {
                holdTimer++;
                // ØªØ£Ø«ÙŠØ± Ø¨ØµØ±ÙŠ: Ø¥Ø¶Ø§Ø¡Ø© Ø§Ù„ÙƒØ§Ø±Ø¯ Ø§Ù„Ù…Ø­Ø¯Ø¯
                highlightCard(color);

                // Ø¥Ø°Ø§ Ø«Ø¨Øª Ø§Ù„Ù„ÙˆÙ† Ù„Ù…Ø¯Ø© Ø«Ø§Ù†ÙŠØ© ØªÙ‚Ø±ÙŠØ¨Ø§Ù‹ (30 Ø¥Ø·Ø§Ø±)
                if (holdTimer > 30) {
                    submitAnswer(color);
                }
            } else {
                holdTimer = 0;
                lastDetected = color;
                clearHighlights();
            }
        }

        function highlightCard(color) {
            clearHighlights();
            const card = document.getElementById(`card-${color}`);
            if(card) {
                card.classList.add('selected');
                card.style.borderColor = "#fff"; // ØªÙ„Ù…ÙŠØ­ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…
            }
        }

        function clearHighlights() {
            document.querySelectorAll('.option').forEach(el => {
                el.classList.remove('selected');
                el.style.borderColor = "transparent"; // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø­Ø¯ÙˆØ¯ Ø´ÙØ§ÙØ©
            });
        }

        function submitAnswer(userColor) {
            isScanning = false;
            const correctColor = questions[currentQIndex].correct;
            const resBadge = document.getElementById(`res-${userColor}`);
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù†ØªÙŠØ¬Ø© ÙÙŠ Ù…ÙƒØ§Ù† Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©
            resBadge.style.display = "inline-block";
            
            if (userColor === correctColor) {
                resBadge.innerText = "âœ… ØµØ­ÙŠØ­!";
                resBadge.style.color = "#2ecc71";
                score++;
                document.getElementById('score').innerText = score;
            } else {
                resBadge.innerText = "âŒ Ø®Ø·Ø£!";
                resBadge.style.color = "#e74c3c";
                
                // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© Ø£ÙŠØ¶Ø§Ù‹ Ù„Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©
                const correctBadge = document.getElementById(`res-${correctColor}`);
                correctBadge.innerText = "ğŸ‘ˆ Ø§Ù„Ø­Ù„";
                correctBadge.style.display = "inline-block";
            }

            // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ Ø¨Ø¹Ø¯ Ø«Ø§Ù†ÙŠØªÙŠÙ†
            setTimeout(() => {
                currentQIndex++;
                loadQuestion();
            }, 2000);
        }

        function resetCards() {
            document.querySelectorAll('.result-badge').forEach(el => el.style.display = 'none');
            clearHighlights();
        }
    </script>
</body>
</html>